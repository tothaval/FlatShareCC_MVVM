<UserControl x:Class="SharedLivingCostCalculator.Views.FlatManagementView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:SharedLivingCostCalculator.Views"
             xmlns:utils="clr-namespace:SharedLivingCostCalculator.Utility"
             x:Name="FMV"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800"
               Background="{DynamicResource SCB_Background}"
             >
    <UserControl.Resources>

        <utils:InverseVisibilityConverter x:Key="InverseVisibilityConverter"/>
        <utils:VisibilityConverter x:Key="VisibilityConverter"/>

        <Style x:Key="Header" TargetType="TextBlock">
            <Setter Property="Foreground" Value="{DynamicResource R_Header}"/>
            <Setter Property="FontSize" Value="36"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontFamily" Value="Verdana"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="20 5 20 5"/>
        </Style>

    </UserControl.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="auto"/>
        </Grid.RowDefinitions>

        <TextBlock Text="{Binding HeaderText}"
                   Grid.Row="0"
                   Style="{StaticResource Header}"/>

        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="0.55*"/>
                <ColumnDefinition Width="0.15*"/>
                <ColumnDefinition Width="0.15*"/>
                <ColumnDefinition Width="0.15*"/>
            </Grid.ColumnDefinitions>
        
            <Button Content="New Flat"
                Command="{Binding NewFlatCommand}"
                    CommandParameter="{x:Reference Name=FMV}"
                    Grid.Column="0"/>

            <Button Content="Edit"                 
                  HorizontalAlignment="Stretch"
                    Command="{Binding EditFlatCommand}"
                    CommandParameter="{Binding ElementName=LV_FlatCollection, Path=SelectedItem}"
                    IsEnabled="{Binding FlatCollectionFilled, NotifyOnSourceUpdated=True}"
                     Visibility="{Binding HasFlat, Converter={StaticResource VisibilityConverter}}"
                    HorizontalContentAlignment="Center"
                    Grid.Column="1"/>

            <Button Content="Delete"
                    HorizontalAlignment="Stretch"
                    Command="{Binding DeleteFlatCommand}"
                    CommandParameter="{Binding ElementName=LV_FlatCollection, Path=SelectedItem}"
                    IsEnabled="{Binding FlatCollectionFilled, NotifyOnSourceUpdated=True}"
                     Visibility="{Binding HasFlat, Converter={StaticResource VisibilityConverter}}"
                    HorizontalContentAlignment="Center"
                    Grid.Column="2"/>

            <Button Content="Settings"
                    Command="{Binding SettingsCommand}"
                    CommandParameter="{x:Reference Name=FMV}"
                    Grid.Column="3"/>
        </Grid>


        <TextBlock Text="{Binding FlatManagementInstructionText}"
                     Visibility="{Binding HasFlat, Converter={StaticResource InverseVisibilityConverter}}"
                   Margin="20" HorizontalAlignment="Center" TextAlignment="Left"
                   Grid.Row="2"/>

        <ListView ItemsSource="{Binding FlatCollection}"
                  SelectedItem="{Binding SelectedValue}"
                     Visibility="{Binding HasFlat, Converter={StaticResource VisibilityConverter}}"
                  x:Name="LV_FlatCollection"
                  SelectionMode="Single"
                  Grid.Row="2">                    
                
        <ListView.View>
                <GridView>
                    <GridViewColumn Header="Flat ID">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding ID}"
                                           TextAlignment="Right"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>

                    <GridViewColumn Header="Address">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Address}"
                                           TextAlignment="Right"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>

                    <GridViewColumn Header="Details">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Details}"
                                           TextAlignment="Right"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>

                    <GridViewColumn Header="Area">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Area}"
                                           TextAlignment="Right"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>

                    <GridViewColumn Header="Rooms">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding RoomCount}"
                                           TextAlignment="Right"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                </GridView>
            </ListView.View>
        </ListView>


        <Button Content="Accounting"
                Command="{Binding AccountingCommand}"
                CommandParameter="{Binding ElementName=LV_FlatCollection, Path=SelectedItem}"
                     Visibility="{Binding HasFlat, Converter={StaticResource VisibilityConverter}}"
                Grid.Row="3"
                />

        <StackPanel Grid.Row="4" 
                     Visibility="{Binding HasFlat, Converter={StaticResource VisibilityConverter}}">

            <StackPanel Orientation="Horizontal">
                <TextBlock Text="Address:"/>
                <TextBlock Text="{Binding SelectedValue.Address, Mode=OneWay,
                    NotifyOnSourceUpdated=True}"/>
                <TextBlock Text="Details:"/>
                <TextBlock Text="{Binding SelectedValue.Details, Mode=OneWay,
                    NotifyOnSourceUpdated=True}"/>
            </StackPanel>


            <StackPanel Orientation="Horizontal">
                <TextBlock Text="Area:"/>
                <TextBlock Text="{Binding SelectedValue.Area, Mode=OneWay,
                    NotifyOnSourceUpdated=True, StringFormat=N2}"/>


                <TextBlock Text="Shared Area:"/>
                <TextBlock Text="{Binding SelectedValue.CurrentCosts.SharedArea, Mode=OneWay,
                    NotifyOnSourceUpdated=True, StringFormat=N2}"/>
            </StackPanel>
            
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="Cold Rent:"/>
                <TextBlock Text="{Binding SelectedValue.CurrentCosts.Rent, Mode=OneWay,
                    NotifyOnSourceUpdated=True, StringFormat=C2, ConverterCulture=de-DE}"/>


                <TextBlock Text="Shared Cold Rent:"/>
                <TextBlock Text="{Binding SelectedValue.CurrentCosts.SharedRent, Mode=OneWay,
                    NotifyOnSourceUpdated=True,  StringFormat=C2, ConverterCulture=de-DE}"/>
            </StackPanel>

            <StackPanel Orientation="Horizontal">
                <TextBlock Text="Extra Costs:"/>
                <TextBlock Text="{Binding SelectedValue.CurrentCosts.ExtraCosts, Mode=OneWay,
                    NotifyOnSourceUpdated=True,  StringFormat=C2, ConverterCulture=de-DE}"/>


                <TextBlock Text="Shared Extra Costs:"/>
                <TextBlock Text="{Binding SelectedValue.CurrentCosts.SharedExtraCosts, Mode=OneWay,
                    NotifyOnSourceUpdated=True,  StringFormat=C2, ConverterCulture=de-DE}"/>
            </StackPanel>


            <ListView ItemsSource="{Binding SelectedValue.CurrentRoomCosts, NotifyOnSourceUpdated=True,
                UpdateSourceTrigger=PropertyChanged}"
                  SelectionMode="Single" Grid.Row="5"
                      ScrollViewer.VerticalScrollBarVisibility="Auto"
                      BorderThickness="0"
                      Margin="0 5 0 0"
                      >
                <ListView.ItemContainerStyle>
                    <Style TargetType="ListViewItem">
                        <Setter Property="HorizontalContentAlignment" Value="Right"/>
                        <Setter Property="TextBlock.TextAlignment" Value="Right"/>
                        <Setter Property="TextBox.TextAlignment" Value="Right"/>
                    </Style>                    
                </ListView.ItemContainerStyle>
                
                <ListView.View>
                    <GridView>
                        <GridViewColumn DisplayMemberBinding="{Binding Room.ID,
                                UpdateSourceTrigger=PropertyChanged,
                            NotifyOnSourceUpdated=True, 
                                Mode=OneWay}" Header="Room"/>
                        <GridViewColumn DisplayMemberBinding="{Binding Room.RoomName,
                                UpdateSourceTrigger=PropertyChanged,
                            NotifyOnSourceUpdated=True, 
                                Mode=OneWay}" Header="Room"/>
                        <GridViewColumn DisplayMemberBinding="{Binding Room.RoomArea,
                                UpdateSourceTrigger=PropertyChanged,
                            NotifyOnSourceUpdated=True,
                                Mode=OneWay,
                                StringFormat=N2, Delay=500}" Header="Area"/>
                        <GridViewColumn DisplayMemberBinding="{Binding RentShare,
                                UpdateSourceTrigger=PropertyChanged,
                            NotifyOnSourceUpdated=True,
                                Mode=OneWay, StringFormat=C2, ConverterCulture=de-DE, Delay=500}" Header="Rent"/>
                        <GridViewColumn DisplayMemberBinding="{Binding ExtraCostsShare,
                                UpdateSourceTrigger=PropertyChanged,
                            NotifyOnSourceUpdated=True,
                                Mode=OneWay, StringFormat=C2, ConverterCulture=de-DE, Delay=500}" Header="Extra"/>
                        <GridViewColumn DisplayMemberBinding="{Binding TotalCosts,
                                UpdateSourceTrigger=PropertyChanged,
                            NotifyOnSourceUpdated=True,
                                Mode=OneWay, StringFormat=C2, ConverterCulture=de-DE, Delay=500}" Header="Total"/>
                    </GridView>
                </ListView.View>

            </ListView>


        </StackPanel>
    </Grid>
</UserControl>
