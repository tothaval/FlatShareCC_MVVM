<UserControl x:Class="SharedLivingCostCalculator.Views.PaymentsSetupView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:SharedLivingCostCalculator.Views"
             xmlns:vms="clr-namespace:SharedLivingCostCalculator.ViewModels"
             xmlns:components="clr-namespace:SharedLivingCostCalculator.Components"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </UserControl.Resources>

    <StackPanel Orientation="Vertical">

        <Grid Margin="5 2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="auto"/>
                <ColumnDefinition Width="auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0" Orientation="Horizontal">

                <TextBlock Text="{DynamicResource IDF_Quantity}" VerticalAlignment="Center" />
                <TextBox Text="{Binding Quantity, UpdateSourceTrigger=PropertyChanged}"
                    MinWidth="50"
                    />
                <Button Content ="{DynamicResource IDF_AddPayment}" Command="{Binding AddPaymentCommand}"
                   CommandParameter="{Binding Quantity}"
                   Padding="3" Margin="5 0"/>
            </StackPanel>

            <Button Content="{DynamicResource IDF_DeletePayment}" Command="{Binding DeletePaymentCommand}" Grid.Column="1"
               CommandParameter="{Binding ElementName=_payments, Path=SelectedItems}"
                   Margin="5 0" Padding="3"
               HorizontalAlignment="Right"/>
        </Grid>


        <ScrollViewer VerticalScrollBarVisibility="Auto"
                                  MaxHeight="420">

            <DataGrid ItemsSource="{Binding Payments, NotifyOnSourceUpdated=True}"
                      SelectionMode="Extended"
                      x:Name="_payments">
                <DataGrid.Columns>
                    <DataGridTemplateColumn Header="{DynamicResource IDF_PaymentStartDate}">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <DatePicker SelectedDate="{Binding StartDate,StringFormat=d, ConverterCulture=de-DE,
                                                    UpdateSourceTrigger=PropertyChanged, NotifyOnSourceUpdated=True,
                                                    ValidatesOnDataErrors=true}"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTemplateColumn Header="{DynamicResource IDF_PaymentEndDate}">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <DatePicker SelectedDate="{Binding EndDate,StringFormat=d, ConverterCulture=de-DE,
                                                    UpdateSourceTrigger=PropertyChanged, NotifyOnSourceUpdated=True,
                                                    ValidatesOnDataErrors=true}"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    
                    <DataGridTextColumn Header="{DynamicResource IDF_Payment}"
                                        Binding="{Binding Sum, NotifyOnSourceUpdated=True,
                                                    UpdateSourceTrigger=PropertyChanged,                                                    
                                                    ValidatesOnDataErrors=true,
                                                    StringFormat=C2, ConverterCulture=de-DE,
                                                    Delay=500}"/>

                    <DataGridTextColumn Header="{DynamicResource IDF_PaymentQuantity}"
                                        Binding="{Binding PaymentQuantity, NotifyOnSourceUpdated=True,
                                                    UpdateSourceTrigger=PropertyChanged,                                                    
                                                    ValidatesOnDataErrors=true, 
                                                    Delay=500}"/>

                    <DataGridTextColumn Header="{DynamicResource IDF_PaymentTotal}"
                                        Binding="{Binding PaymentTotal, NotifyOnSourceUpdated=True,
                                                    UpdateSourceTrigger=PropertyChanged,                                                    
                                                    ValidatesOnDataErrors=true, 
                                                    StringFormat=C2, ConverterCulture=de-DE,
                                                    Delay=500}"/>
                </DataGrid.Columns>

            </DataGrid>
        </ScrollViewer>
        
    </StackPanel>
</UserControl>
